æ˜ç™½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¿™ä¸ªç›®æ ‡åˆ¶å®šä¸€ä¸ªæ¸…æ™°çš„æ¶æ„è®¾è®¡å’Œå®ç°ç­–ç•¥ï¼Œä½¿ä½ çš„åŠ¨æ€åº“æ—¢èƒ½åœ¨æ™®é€šé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¹Ÿèƒ½åœ¨éœ€è¦ ROS2 é€šä¿¡çš„æƒ…å†µä¸‹å¼€å¯ç›¸å…³åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä»é›¶å¼€å§‹çš„æ„å»ºæ€è·¯å’Œæ“ä½œæ­¥éª¤ï¼š

---

## ğŸŒ± ä¸€ã€è®¾è®¡æ€æƒ³æ€»è§ˆ

å¸Œæœ›åšåˆ°ï¼š

- åŠ¨æ€åº“ (`.so`) æœ¬èº«ç»“æ„ä¸å˜ï¼Œç»§ç»­å°è£…ä½ çš„åŠŸèƒ½ç±»ã€‚
- åŠ¨æ€åº“å¯¹ ROS2 æ˜¯â€œå¯é€‰çš„â€ï¼šè°ƒç”¨æ–¹å¯ä»¥å†³å®šæ˜¯å¦å¯ç”¨ ROS2 é€šä¿¡ã€‚
- ROS2 ç›¸å…³é€»è¾‘åœ¨ç±»ä¸­ç‹¬ç«‹ã€å¯å¼€å…³ã€ä¸ä¼šæ±¡æŸ“åŸæœ‰é€»è¾‘ã€‚

---

## ğŸ“¦ äºŒã€åŠ¨æ€åº“çš„ç»“æ„ç¤ºä¾‹

å‡è®¾ä½ çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
my_lib/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ my_lib/
â”‚       â”œâ”€â”€ core.hpp         // åŸå§‹åŠŸèƒ½ç±»å®šä¹‰
â”‚       â””â”€â”€ ros2_support.hpp // ROS2 æ”¯æŒå°è£…
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core.cpp             // åŸå§‹åŠŸèƒ½ç±»å®ç°
â”‚   â””â”€â”€ ros2_support.cpp     // ROS2 å°è£…å®ç°
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ package.xml (å¯é€‰ï¼Œä»…åœ¨éœ€è¦æ„å»º ROS2 æ¥å£æ—¶)
```

---

## ğŸ§  ä¸‰ã€ç±»è®¾è®¡ç­–ç•¥

### 1. åŸå§‹åŠŸèƒ½ç±»ï¼ˆä¾‹å¦‚ `CoreProcessor`ï¼‰

```cpp
// core.hpp
class CoreProcessor {
public:
    void run();
    std::string getResult();
};
```

### 2. ROS2 æ”¯æŒç±»ï¼ˆä¾‹å¦‚ `ROS2Wrapper`ï¼‰

```cpp
// ros2_support.hpp
#include "rclcpp/rclcpp.hpp"
#include "my_msgs/msg/status.hpp"
#include "core.hpp"

class ROS2Wrapper {
public:
    ROS2Wrapper(std::shared_ptr<rclcpp::Node> node, CoreProcessor* processor);
    void publishStatus();
private:
    CoreProcessor* processor_;
    rclcpp::Publisher<my_msgs::msg::Status>::SharedPtr publisher_;
};
```

---

## âš™ï¸ å››ã€æ„å»ºæ–¹å¼

### 1. `CMakeLists.txt`

ä¿æŒå¯¹åŠ¨æ€åº“çš„æ­£å¸¸æ„å»ºï¼ŒåŒæ—¶åŠ å…¥å¯é€‰çš„ ROS2 æ„å»ºè·¯å¾„ï¼š

```cmake
cmake_minimum_required(VERSION 3.8)
project(my_lib)

# åŸå§‹åŠ¨æ€åº“æ–‡ä»¶
add_library(my_lib SHARED
  src/core.cpp
)

target_include_directories(my_lib PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
)

# å¯é€‰ ROS2 æ”¯æŒ
option(ENABLE_ROS2 "Enable ROS2 support" ON)

if(ENABLE_ROS2)
  find_package(rclcpp REQUIRED)
  find_package(my_msgs REQUIRED)

  target_sources(my_lib PRIVATE
    src/ros2_support.cpp
  )
  target_link_libraries(my_lib PUBLIC rclcpp my_msgs::my_msgs)
  target_compile_definitions(my_lib PRIVATE ENABLE_ROS2_SUPPORT)
endif()
```

### 2. æ¡ä»¶ç¼–è¯‘å¤„ç†

```cpp
#ifdef ENABLE_ROS2_SUPPORT
    // ROS2 åŠŸèƒ½ç¼–è¯‘å¼€å¯
#endif
```

---

## ğŸš€ äº”ã€è°ƒç”¨ç«¯ä½¿ç”¨æ–¹å¼

### ä¸ä½¿ç”¨ ROS2

```cpp
#include "my_lib/core.hpp"

int main() {
    CoreProcessor proc;
    proc.run();
}
```

### ä½¿ç”¨ ROS2

```cpp
#include "my_lib/core.hpp"
#include "my_lib/ros2_support.hpp"
#include "rclcpp/rclcpp.hpp"

int main(int argc, char* argv[]) {
    rclcpp::init(argc, argv);
    auto node = rclcpp::Node::make_shared("ros2_enabled_node");

    CoreProcessor proc;
    ROS2Wrapper ros2(node, &proc);
    ros2.publishStatus();

    rclcpp::spin(node);
    rclcpp::shutdown();
}
```

---

## âœ… å…­ã€ä½ å¯ä»¥è‡ªç”±æ§åˆ¶

- æ˜¯å¦åœ¨æ„å»ºä¸­åŠ å…¥ ROS2ï¼Œåªéœ€è®¾ç½® `ENABLE_ROS2=OFF`ã€‚
- æ˜¯å¦åœ¨è°ƒç”¨æ—¶åˆå§‹åŒ– ROS2ï¼Œåªè¦åˆ¤æ–­ç¯å¢ƒå³å¯ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ä¸€æ­¥æ­¥æ­å»ºè¿™ä¸ªç»“æ„ï¼Œæˆ–è€…ä½ æŠŠç°æœ‰ç±»çš„ç®€åŒ–ç»“æ„è´´ç»™æˆ‘ï¼Œæˆ‘æ¥ç»™ä½ æ”¹é€ æˆæ”¯æŒ ROS2 çš„ç‰ˆæœ¬ã€‚ä½ çœ‹æˆ‘ä»¬ä¸‹ä¸€æ­¥æ˜¯ä»å†™ç±»ã€æ•´ç† CMakeï¼Œè¿˜æ˜¯åšä¸ª demo èµ·æ­¥ï¼Ÿ