# IMU
IMU（Inertial Measurement Unit，惯性测量单元）是一种传感器模块，用于测量物体的运动状态，包括加速度、角速度，有时还包括磁场强度。

## IMU 的基本组成
| 传感器类型                | 测量内容          | 单位          |
| -------------------- | ------------- | ----------- |
| 加速度计 (Accelerometer) | 线性加速度（X/Y/Z轴） | m/s² 或 g    |
| 陀螺仪 (Gyroscope)      | 角速度（绕 X/Y/Z轴） | rad/s 或 °/s |
| 磁力计 (Magnetometer)   | 地磁场强度（X/Y/Z轴） | µT（微特斯拉）    |

### 加速度计
IMU 内部的加速度计 (Accelerometer) 测量的是**非重力加速度 (non-gravitational acceleration)**，或者更准确地说是惯性力（specific force）。这与我们日常生活中感受到的“重力”是同一种力。

#### 加速度计工作原理
- 内部结构： 
    加速度计通常由一个带有弹簧的微小“检测质量块”（proof mass）组成。当传感器加速时，这个质量块会因为惯性而试图保持其原始状态，导致它相对于传感器的外壳产生位移。传感器通过测量这个位移来计算加速度。
- 感受“推力”：
    - 当你乘坐汽车加速时： 你会感受到一股力把你推向座椅。加速度计测量到的就是这个“推力”引起的加速度。

    - 当你静止站在地球上时： 地面（或桌子）对你施加一个向上的支持力（法向力），正是这个支持力阻止你自由落体。你的加速度计感受到的正是这个向上的支持力所产生的加速度。

    - 这个向上的支持力的大小等于你所受的重力大小。 因此，当 IMU 静止在桌子上时，它感受到的是桌子对它施加的、大小等于重力加速度 g (约 9.81 m/s²) 的向上的力，并将其测量为一个大小为 g，方向向上的加速度。

简而言之：

**加速度计测量的是你所感受到的力，而不是你相对于地球中心的纯粹运动加速度。** 
在自由落体时，你不会感受到任何力，所以加速度计会读数为零。当你在地球表面静止时，你被地面向上支撑着，所以你感受到了一个向上的力，加速度计就测量到了这个力所产生的向上的加速度，其大小等于重力加速度 g。

### 陀螺仪
陀螺仪，也被称为角速度传感器，是一种用来测量物体在空间中旋转快慢的装置。
现代机器人和日常设备（如智能手机、无人机、稳定器）中使用的陀螺仪，绝大多数是 **MEMS 陀螺仪 (Micro-Electro-Mechanical System Gyroscope)**，它们的工作原理基于**科里奥利力（Coriolis force）**。

#### 陀螺仪工作原理
- 振动元件： 
    MEMS 陀螺仪内部有一个微小的机械结构（通常是硅片），它被设计成以特定的频率和振幅进行持续的、线性的振动。你可以想象它像一个微小的弹簧振子，或者在一个方向上不断来回移动的质量块。这个振动被称为驱动振动。

- 科里奥利力：

    科里奥利力是一种惯性力，当一个物体在旋转的参考系中进行直线运动时，就会感受到这种力。
    想象你站在一个旋转的转盘上，并尝试从中心径向地（直线地）走到边缘。当你径向移动时，你会感受到一个垂直于你移动方向的力，把你推向转盘的旋转方向。这就是科里奥利力。

- 感应振动：

    当 MEMS 陀螺仪的振动元件在进行驱动振动时，如果陀螺仪本身（即它所在的物体）也发生旋转，那么振动元件就会在旋转的参考系中运动。
    此时，科里奥利力就会作用于振动元件，产生一个垂直于驱动振动方向和旋转轴方向的力。这个力会导致振动元件产生第二个、微小的感应振动（或称科里奥利振动）。
- 电信号转换：
    MEMS 陀螺仪通过感应电容或压电效应来检测这个微小的感应振动。
    - 电容式： 
        振动元件的位移会改变电极之间的电容，传感器通过测量电容的变化来计算位移。
    - 压电式： 
        振动元件上的压电材料在受力（科里奥利力）变形时会产生电压，传感器通过测量电压来计算力的大小。
    传感器将这个感应振动的大小（电容差或电压）转换为电信号输出，这个电信号的大小就与角速度成正比。
- 输出角速度： 
    最终，陀螺仪的输出就是经过信号处理后的角速度，通常以 度/秒 (dps) 或 弧度/秒 (rad/s) 为单位。

### 磁力计
磁力计 (Magnetometer)，也常被称为地磁传感器，是用来测量磁场强度和方向的设备。在 IMU 中，磁力计通常用来测量地球的地磁场，从而帮助机器人确定方向（Heading 或 Yaw 角）。

#### 工作原理（以霍尔效应传感器为例）
- 霍尔元件： 
    磁力计的核心是一个被称为霍尔元件的半导体薄片。

- 电流通过： 
    当电流通过这个半导体薄片时，电子会沿直线移动。

- 磁场影响： 
    如果此时有一个垂直于电流方向的磁场穿过这个霍尔元件，那么磁场会对移动的电子施加一个洛伦兹力 (Lorentz force)。

- 电子偏转： 
    洛伦兹力会导致电子偏向半导体薄片的一侧。
- 电压差产生 (霍尔电压)： 
    当电子偏向一侧时，会在半导体薄片的两侧（垂直于电流方向和磁场方向）产生一个电压差。这个电压差就被称为霍尔电压。

- 测量磁场： 
    霍尔电压的大小与施加的磁场强度成正比，方向则与磁场方向和电流方向的相对关系有关。通过测量这个霍尔电压，磁力计就能计算出磁场的强度和方向。

简化类比：

想象你在一片草地上往前走（电流方向），突然刮起一阵侧风（磁场方向）。这阵风会把你吹向一边。如果你被吹得越厉害，说明风越大。霍尔元件就是通过测量被“吹到”一边的“距离”或“力”，来判断风（磁场）的大小和方向。

## IMU输出结果
| 信息                  | 含义               |
| ------------------- | ---------------- |
| Roll                | 绕 X 轴的旋转角        |
| Pitch               | 绕 Y 轴的旋转角        |
| Yaw                 | 绕 Z 轴的旋转角（航向）    |
| Orientation         | 姿态（通常以四元数或欧拉角表示） |
| Linear Acceleration | 去除重力后的线性加速度      |

## 传感器融合（Sensor Fusion）
由于各传感器都有噪声或漂移，单独使用容易误差积累，因此通常使用滤波算法进行融合：
| 融合算法                 | 简介                    |
| -------------------- | --------------------- |
| 卡尔曼滤波（EKF）           | 常用于 ROS 中的 IMU+GPS 融合 |
| Madgwick             | 一种高性能的姿态解算算法，适合低算力芯片  |
| Mahony               | 姿态估算算法，响应速度好，稳定性高     |
| Complementary Filter | 简单有效的加速度计 + 陀螺仪组合滤波算法 |
